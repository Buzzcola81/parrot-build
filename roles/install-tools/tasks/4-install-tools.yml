---
- name: "Install dislocker utility"
  apt:
    name:
      - dislocker
    state: present
  become: true
  become_method: sudo

- name: "Install xfreerdp utility"
  apt:
    name:
      - freerdp2-x11
    state: present
  become: true
  become_method: sudo

- name: Ensure pipx is installed
  apt:
    name: pipx
    state: present
  become: true
  become_method: sudo

- name: Ensure pipx path is set up
  command: pipx ensurepath
  changed_when: false

- name: Install defaultcreds-cheat-sheet with pipx (as normal user)
  command: pipx install --force defaultcreds-cheat-sheet
  become: false
  args:
    creates: "{{ lookup('env','HOME') }}/.local/pipx/venvs/defaultcreds-cheat-sheet"

- name: Install pypykatz with pipx (as normal user)
  command: pipx install --force pypykatz
  become: false
  args:
    creates: "{{ lookup('env','HOME') }}/.local/pipx/venvs/pypykatz"

- name: Install donpapi with pipx (as normal user)
  command: pipx install --force donpapi
  become: false
  args:
    creates: "{{ lookup('env','HOME') }}/.local/pipx/venvs/donpapi"

# This is for https://github.com/lgandx/PCredz?tab=readme-ov-file
- name: Install Cython with pipx (as normal user)
  command: pipx install --force Cython
  become: false
  args:
    creates: "{{ lookup('env','HOME') }}/.local/pipx/venvs/Cython"

# This is for https://github.com/lgandx/PCredz?tab=readme-ov-file
- name: Install python-libpcap with pipx (as normal user)2
  command: pipx install --force python-libpcap
  become: false
  args:
    creates: "{{ lookup('env','HOME') }}/.local/pipx/venvs/pylibpcap"

- name: "Install pipx tools"
  community.general.pipx:
    name: "{{ item.name }}"
    source: "{{ item.url }}"
    state: latest
  loop:
    - { name: 'python-libpcap', url: 'git+https://github.com/karpierz/libpcap' }


    # - { name: 'impacket', url: 'git+https://github.com/fortra/impacket.git' }
    # - { name: 'netexec', url: 'git+https://github.com/Pennyw0rth/NetExec.git' }
    # - { name: 'certipy-ad', url: 'git+https://github.com/ly4k/Certipy.git' }
    # - { name: 'bloodhound-ce', url: 'git+https://github.com/dirkjanm/BloodHound.py.git@bloodhound-ce' }